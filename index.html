<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Os</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- Bootstrap (modals) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --accent:#00e6ff;
      --accent-2:#7a42ff;
      --bg-dark:#00060a;
      --glass: rgba(255,255,255,0.03);
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg-dark);
      font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color:#eafcff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
    }

    /* ===== canvases ===== */
    canvas#bgCanvas, canvas#fxCanvas { position:fixed; inset:0; z-index:0; display:block; }
    #ui { position:relative; z-index:8; }

    /* center stage */
    .stage {
      position:relative;
      z-index:8;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      box-sizing:border-box;
    }

    /* main shell */
    .shell {
      width:100%;
      max-width:1100px;
      border-radius:18px;
      padding:28px;
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:22px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(0,200,255,0.10);
      box-shadow: 0 18px 60px rgba(0,0,0,0.7), inset 0 0 40px rgba(0,80,160,0.03);
      backdrop-filter: blur(8px) saturate(1.1);
    }
    @media (max-width:940px){
      .shell{ grid-template-columns: 1fr; padding:18px; max-width:92%; }
    }

    /* left */
    .left h1{ font-family: 'Orbitron', sans-serif; color:var(--accent); margin:0; font-size:34px; letter-spacing:2px; text-shadow:0 0 16px rgba(0,230,255,0.12) }
    .subtitle { color:#9feeff; margin-top:8px; font-size:13px; opacity:.95 }

    .meta {
      margin-top:18px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .meta .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius:12px;
      padding:12px 14px;
      min-width:150px;
      border:1px solid rgba(0,200,255,0.06);
      box-shadow: 0 6px 22px rgba(0,0,0,0.5);
    }
    .meta .label{ font-size:12px; color: #9fe8ff }
    .meta .value{ font-weight:700; color:#fff; margin-top:6px }

    .actions { margin-top:20px; display:flex; flex-direction:column; gap:12px; }

    .btn-neo {
      padding:14px 16px;
      border-radius:12px;
      border:1px solid rgba(0,200,255,0.12);
      background: linear-gradient(90deg, rgba(0,200,255,0.04), rgba(110,20,255,0.02));
      color:var(--accent);
      font-weight:700;
      letter-spacing:.6px;
      cursor:pointer;
      transition: transform .18s cubic-bezier(.2,.9,.2,1), box-shadow .18s;
      position:relative;
      overflow:visible;
    }
    .btn-neo:hover{ transform:translateY(-6px); box-shadow: 0 20px 50px rgba(0,120,255,0.10); }

    /* right column */
    .right { display:flex; flex-direction:column; gap:12px; align-items:center; padding:12px }
    .profile {
      width:100%;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius:12px;
      padding:18px;
      border:1px solid rgba(0,200,255,0.06);
      text-align:center;
    }
    .githubIcon{ font-size:52px; color:var(--accent); transition:transform .2s; display:inline-block; }
    .githubIcon:hover{ transform:scale(1.12); filter:drop-shadow(0 0 18px #00eaff) }

    .small{ font-size:13px; color:rgba(220,255,255,0.78) }

    /* nim animated typing */
    #nim {
      font-family: 'Orbitron', monospace;
      color:var(--accent);
      font-weight:700;
      font-size:18px;
      display:inline-block;
      white-space:nowrap;
      overflow:hidden;
      border-right: 2px solid rgba(0,230,255,0.95);
      width:0;
      animation: type 2.4s steps(18) forwards, blink .9s steps(1) infinite;
    }
    @keyframes type{ to { width: 200px; } }
    @keyframes blink{ 50% { border-color: transparent; } }

    /* loader overlay */
    #loader {
      position:fixed; inset:0; z-index:99999;
      display:flex; align-items:center; justify-content:center; flex-direction:column;
      background: radial-gradient(circle at 30% 20%, rgba(2,20,40,0.9), rgba(0,2,10,0.95));
      color:var(--accent);
    }
    .loaderOrb { width:86px; height:86px; border-radius:50%; background: conic-gradient(#00eaff,#7a42ff,#00eaff); animation: spin 2.6s linear infinite; box-shadow:0 0 30px rgba(0,230,255,0.12) }
    .loaderTxt { margin-top:14px; font-family:Orbitron; letter-spacing:2px; }

    @keyframes spin{ to{ transform: rotate(360deg) } }

    /* audio control */
    .audioCtrl { position:fixed; right:18px; bottom:18px; z-index:90; display:flex; gap:8px; align-items:center; background: rgba(0,0,0,0.42); padding:8px; border-radius:12px; border:1px solid rgba(0,200,255,0.08) }

    /* burst canvas hint */
    .burstCanvas { position:fixed; inset:0; z-index:6; pointer-events:none; }

    /* small responsive */
    @media (max-width:640px){
      .githubIcon{ font-size:40px }
      .left h1{ font-size:24px }
      #nim{ font-size:16px }
    }
  </style>
</head>
<body>

  <!-- background procedural canvas -->
  <canvas id="bgCanvas" aria-hidden="true"></canvas>
  <!-- fx canvas (meteors, bursts, mouse light) -->
  <canvas id="fxCanvas" class="burstCanvas" aria-hidden="true"></canvas>

  <!-- loader -->
  <div id="loader" role="status" aria-live="polite">
    <div class="loaderOrb" aria-hidden="true"></div>
    <div class="loaderTxt">Sabar Ya...</div>
    <div style="margin-top:8px; color:rgba(200,255,255,0.7)">Menginisialisasi…</div>
  </div>

  <!-- audio control -->
  <div class="audioCtrl" id="audioCtrl" role="region" aria-label="Kontrol audio">
    <button id="audioBtn" class="btn btn-sm btn-outline-light">Unmute</button>
    <span class="small">Ambient</span>
  </div>

  <!-- UI -->
  <div id="ui">
    <div class="stage">
      <div class="shell" role="main" aria-label="Dashboard Tugas">

        <!-- left -->
        <div class="left" style="padding-right:6px">
          <h1>Selamat Datang</h1>
          <div class="subtitle">:)</div>

          <div class="meta">
            <div class="card"><div class="label">Nama</div><div class="value">Hamid Albar</div></div>
            <div class="card"><div class="label">Kelas</div><div class="value">IM24B</div></div>
            <div class="card"><div class="label">NIM</div><div class="value"><span id="nim">102240047</span></div></div>
          </div>

          <div class="meta" style="margin-top:12px">
            <div class="card"><div class="label">Mata Kuliah</div><div class="value">Sistem Operasi</div></div>
            <div class="card"><div class="label">Dosen Pengampu</div><div class="value">Pak Arif</div></div>
          </div>

          <div class="actions">
            <button class="btn-neo" id="btnUTS" data-link="https://thingforall.github.io/Instalasi-Kali-Linux/">➤ Buka Tugas UTS</button>
            <button class="btn-neo" id="btnUAS" data-link="https://thingforall.github.io/uas-os-page/">➤ Buka Tugas UAS</button>
          </div>

          <div style="margin-top:16px" class="small">Dibuat pada: <span id="created"></span></div>
        </div>

        <!-- right -->
        <div class="right">
          <div class="profile">
            <a id="ghAnchor" href="https://github.com/ThingForAll" target="_blank" rel="noopener noreferrer" aria-label="GitHub ThingForAll">
              <svg class="githubIcon" viewBox="0 0 24 24" width="52" height="52" fill="currentColor" aria-hidden="true">
                <path d="M12 .296a12 12 0 00-3.797 23.4c.6.112.82-.26.82-.577v-2.044c-3.338.726-4.042-1.61-4.042-1.61-.546-1.385-1.333-1.753-1.333-1.753-1.09-.744.083-.729.083-.729 1.205.084 1.84 1.238 1.84 1.238 1.07 1.834 2.809 1.303 3.495.997.108-.775.42-1.303.762-1.602-2.665-.305-5.467-1.333-5.467-5.93 0-1.31.468-2.381 1.236-3.222-.124-.303-.536-1.523.116-3.176 0 0 1.008-.322 3.301 1.23a11.52 11.52 0 016.003 0c2.293-1.553 3.3-1.23 3.3-1.23.653 1.653.241 2.873.118 3.176.77.84 1.235 1.912 1.235 3.222 0 4.61-2.807 5.623-5.48 5.922.431.372.815 1.103.815 2.222v3.293c0 .32.216.694.825.576A12 12 0 0012 .296"></path>
              </svg>
            </a>
            <div style="margin-top:10px; font-weight:700">ThingForAll</div>
            <div class="small" style="margin-top:6px">Klik icon untuk profil GitHub</div>

            <div style="margin-top:14px">
              <button class="btn btn-sm btn-outline-light" onclick="openCampus()">Identitas Kampus</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Modals: double confirm -->
  <div class="modal fade" id="confirm1" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background:#00121a;color:#ccf;">
        <div class="modal-header">
          <h5 class="modal-title">Konfirmasi</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">Apakah kamu yakin ingin membuka halaman ini?</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Tidak</button>
          <button class="btn btn-info" id="toConfirm2">Lanjutkan</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirm2" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background:#00121a;color:#ccf;">
        <div class="modal-header">
          <h5 class="modal-title">Konfirmasi Terakhir</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">Ini adalah konfirmasi terakhir. Lanjutkan?</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Tidak</button>
          <button class="btn btn-danger" id="doOpen">Ya, buka</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Campus modal -->
  <div class="modal fade" id="campusModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background:#00121a;color:#ccf;">
        <div class="modal-header">
          <h5 class="modal-title">Identitas Kampus</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <strong>ITSNU Pekalongan</strong><br>
          Institut Teknologi dan Sains Nahdlatul Ulama Pekalongan
        </div>
      </div>
    </div>
  </div>

  <!-- Audio + Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  /* ===================================================================
     Procedural background (nebula + noise + subtle vortices) on bgCanvas
     FX canvas handles meteors, bursts, mouse light and post effects
     =================================================================== */

  // canvases
  const bgCanvas = document.getElementById('bgCanvas');
  const fxCanvas = document.getElementById('fxCanvas');
  const bgCtx = bgCanvas.getContext('2d');
  const fxCtx = fxCanvas.getContext('2d');

  function resizeAll(){
    bgCanvas.width = fxCanvas.width = innerWidth;
    bgCanvas.height = fxCanvas.height = innerHeight;
  }
  window.addEventListener('resize', resizeAll);
  resizeAll();

  /* -------------------------
     procedural nebula: multi-layer noise (perlin-lite)
     we'll implement simple value-noise for performance
     ------------------------- */
  // simple pseudo-random seeded noise
  function Noise(seed=1){
    let s = seed % 2147483647;
    if(s<=0) s += 2147483646;
    this.next = function(){
      return s = s * 16807 % 2147483647;
    };
    this.rand = function(){ return (this.next() - 1) / 2147483646; };
  }

  // value noise grid
  function ValueNoise(w,h,scale,seed){
    const cols = Math.ceil(w/scale)+2;
    const rows = Math.ceil(h/scale)+2;
    const noise = new Noise(seed||Math.random()*1e9);
    const grid = new Array(cols*rows).fill(0).map(()=> noise.rand());
    function sample(x,y){
      const gx = Math.floor(x/scale);
      const gy = Math.floor(y/scale);
      const fx = (x/scale) - gx;
      const fy = (y/scale) - gy;
      function lerp(a,b,t){ return a + (b-a)*t; }
      function get(ix,iy){ return grid[(ix%cols + cols)%cols + (iy%rows + rows)%rows * cols]; }
      const a = get(gx,gy), b = get(gx+1,gy), c = get(gx,gy+1), d = get(gx+1,gy+1);
      const u = fx, v = fy;
      const m1 = lerp(a,b,u), m2 = lerp(c,d,u);
      return lerp(m1,m2,v);
    }
    return { sample };
  }

  // create layers
  let layers = [];
  function rebuildLayers(){
    const W = bgCanvas.width, H = bgCanvas.height;
    layers = [
      { scale: 420, alpha:0.22, color:[6,20,40], speed:0.02, seed: 1234 },
      { scale: 260, alpha:0.16, color:[25,8,60], speed:0.035, seed: 4321 },
      { scale: 140, alpha:0.1, color:[0,60,120], speed:0.06, seed: 7777 }
    ].map((cfg,i)=>{
      cfg.noise = ValueNoise(W,H,cfg.scale, Math.floor(Math.random()*1e9)+cfg.seed);
      cfg.offset = Math.random()*10000;
      return cfg;
    });
  }
  rebuildLayers();
  window.addEventListener('resize', ()=> setTimeout(rebuildLayers,120));

  /* draw procedural nebula background */
  function drawNebula(time){
    const W = bgCanvas.width, H = bgCanvas.height;
    bgCtx.clearRect(0,0,W,H);

    // gradient base
    const base = bgCtx.createLinearGradient(0,0,0,H);
    base.addColorStop(0, 'rgba(0,6,20,1)');
    base.addColorStop(1, 'rgba(0,0,4,1)');
    bgCtx.fillStyle = base;
    bgCtx.fillRect(0,0,W,H);

    // draw layers
    for(const layer of layers){
      const imgData = bgCtx.createImageData(W,H);
      const data = imgData.data;
      const n = layer.noise;
      const c = layer.color;
      const off = layer.offset + time * layer.speed * 0.0005;
      for(let y=0;y<H;y+=2){
        for(let x=0;x<W;x+=2){
          const v = n.sample(x + off*10, y + off*6);
          const idx = (x + y*W)*4;
          const intensity = Math.pow(v,1.6) * layer.alpha * 255;
          data[idx] = Math.min(255, c[0] + intensity*1.2);
          data[idx+1] = Math.min(255, c[1] + intensity*1.3);
          data[idx+2] = Math.min(255, c[2] + intensity*1.6);
          data[idx+3] = Math.min(255, intensity*1.0);
        }
      }
      bgCtx.putImageData(imgData,0,0);
      // slight blend overlay
      bgCtx.globalCompositeOperation = 'lighter';
    }
    bgCtx.globalCompositeOperation = 'source-over';
  }

  /* =========================
     FX canvas: meteors, bursts, mouse spotlight
     ========================= */
  const meteors = [];
  const bursts = [];
  const stars = []; // helper micro stars
  let lastSpawn = 0;

  function spawnMeteor(){
    const W = fxCanvas.width, H = fxCanvas.height;
    const x = Math.random() * W * 0.6 - W*0.1;
    const y = Math.random() * H * 0.25 - H*0.1;
    const vx = rand(10,16);
    const vy = rand(6,12);
    meteors.push({ x,y,vx,vy,len:rand(100,260), life:1, hue: rand(190,250) });
  }

  function spawnBurst(x,y,hue){
    const n = 22 + Math.floor(rand(0,18));
    for(let i=0;i<n;i++){
      const ang = Math.random()*Math.PI*2;
      const sp = rand(1.6,7.2);
      bursts.push({
        x,y,
        vx: Math.cos(ang)*sp * rand(0.6,1.6),
        vy: Math.sin(ang)*sp * rand(0.6,1.6),
        r: rand(1.2,3.6),
        life: 1.0,
        hue: hue || rand(190,260)
      });
    }
  }

  function rand(min,max){ return Math.random()*(max-min)+min; }

  // mouse spotlight
  const mouse = { x: innerWidth/2, y: innerHeight/2 };

  document.addEventListener('mousemove', (e)=>{
    mouse.x = e.clientX; mouse.y = e.clientY;
  });

  // attach bursts on hover buttons
  const btnUTS = document.getElementById('btnUTS');
  const btnUAS = document.getElementById('btnUAS');

  function attachHoverBurst(el){
    el.addEventListener('mouseenter', ()=>{
      const r = el.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      spawnBurst(cx, cy, 200 + Math.random()*40);
      setTimeout(()=> spawnBurst(cx+rand(-12,12), cy+rand(-8,8), 200), 90);
    });
  }
  attachHoverBurst(btnUTS);
  attachHoverBurst(btnUAS);

  // main FX draw
  function updateFX(dt){
    const W = fxCanvas.width, H = fxCanvas.height;
    fxCtx.clearRect(0,0,W,H);

    // mouse spotlight radial (soft)
    const rad = fxCtx.createRadialGradient(mouse.x, mouse.y, 0, mouse.x, mouse.y, Math.max(200, Math.min(520, Math.max(W,H)*0.25)));
    rad.addColorStop(0, 'rgba(0,230,255,0.10)');
    rad.addColorStop(0.25, 'rgba(110,20,255,0.06)');
    rad.addColorStop(1, 'rgba(0,0,0,0)');
    fxCtx.fillStyle = rad;
    fxCtx.fillRect(0,0,W,H);

    // draw meteors
    for(let i=meteors.length-1;i>=0;i--){
      const m = meteors[i];
      m.x += m.vx * dt;
      m.y += m.vy * dt;
      m.vx *= 0.999;
      m.len *= 0.9996;
      m.life -= 0.002 * dt;

      // trail
      fxCtx.beginPath();
      const g = fxCtx.createLinearGradient(m.x, m.y, m.x - m.vx*8, m.y - m.vy*8);
      g.addColorStop(0, 'rgba(255,255,255,0.95)');
      g.addColorStop(1, 'rgba(0,160,255,0.02)');
      fxCtx.strokeStyle = g;
      fxCtx.lineWidth = 2.2;
      fxCtx.lineCap = 'round';
      fxCtx.moveTo(m.x, m.y);
      fxCtx.lineTo(m.x - m.vx*5, m.y - m.vy*5);
      fxCtx.stroke();

      // head
      fxCtx.beginPath();
      fxCtx.fillStyle = 'rgba(255,255,255,0.95)';
      fxCtx.arc(m.x, m.y, 3.2, 0, Math.PI*2);
      fxCtx.fill();

      if(m.x > W + 200 || m.y > H + 200 || m.life <= 0) meteors.splice(i,1);
    }

    // draw bursts
    for(let i=bursts.length-1;i>=0;i--){
      const b = bursts[i];
      b.x += b.vx * dt;
      b.y += b.vy * dt;
      b.vx *= 0.996; b.vy *= 0.996;
      b.life -= 0.02 * dt;
      const alpha = Math.max(0, b.life);
      fxCtx.beginPath();
      fxCtx.fillStyle = `rgba(255,255,255,${0.85*alpha})`;
      fxCtx.arc(b.x, b.y, b.r * Math.max(0.2, alpha), 0, Math.PI*2);
      fxCtx.fill();
      if(b.life <= 0) bursts.splice(i,1);
    }
  }

  /* animation loop */
  let last = performance.now();
  function frame(now){
    const dt = Math.min(2.0, (now - last)/16.67);
    drawNebula(now);
    if(Math.random() < 0.008) { if(Math.random()<0.5) spawnMeteor(); }
    updateFX(dt);
    last = now;
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);

  /* ============================
     UI small behaviours
     ============================ */
  // created date
  document.getElementById('created').textContent = new Date().toLocaleDateString('id-ID', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

  // loader hide after ready
  window.addEventListener('load', ()=>{
    setTimeout(()=> {
      const loader = document.getElementById('loader');
      loader.style.transition = 'opacity .8s ease';
      loader.style.opacity = '0';
      setTimeout(()=> loader.style.display = 'none', 900);
    }, 800);
  });

  /* ============================
     Double-confirm flow opening GitHub links
     ============================ */
  const conf1 = new bootstrap.Modal(document.getElementById('confirm1'));
  const conf2 = new bootstrap.Modal(document.getElementById('confirm2'));
  let pendingLink = '';

  btnUTS.addEventListener('click', ()=> {
    pendingLink = btnUTS.dataset.link;
    conf1.show();
  });
  btnUAS.addEventListener('click', ()=> {
    pendingLink = btnUAS.dataset.link;
    conf1.show();
  });

  document.getElementById('toConfirm2').addEventListener('click', ()=> {
    conf1.hide();
    setTimeout(()=> conf2.show(), 220);
  });

  document.getElementById('doOpen').addEventListener('click', ()=> {
    conf2.hide();
    if(pendingLink){
      window.open(pendingLink, '_blank', 'noopener');
      pendingLink = '';
    }
  });

  function openCampus(){ new bootstrap.Modal(document.getElementById('campusModal')).show(); }

  /* ============================
     Audio: ambient deep pad created with WebAudio (no external file)
     starts muted, user can unmute
     ============================ */
  let audioCtx, masterGain, isPlaying = false;
  const audioBtn = document.getElementById('audioBtn');

  function startAudio(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 0.0001; // start near silent
    masterGain.connect(audioCtx.destination);

    // low pad
    const o1 = audioCtx.createOscillator(); o1.type = 'sine'; o1.frequency.value = 36;
    const g1 = audioCtx.createGain(); g1.gain.value = 0.12;
    const flt1 = audioCtx.createBiquadFilter(); flt1.type = 'lowpass'; flt1.frequency.value = 1000;
    o1.connect(g1); g1.connect(flt1); flt1.connect(masterGain);
    o1.start();

    // second pad
    const o2 = audioCtx.createOscillator(); o2.type = 'sine'; o2.frequency.value = 48;
    const g2 = audioCtx.createGain(); g2.gain.value = 0.08;
    const flt2 = audioCtx.createBiquadFilter(); flt2.type = 'lowpass'; flt2.frequency.value = 1200;
    o2.connect(g2); g2.connect(flt2); flt2.connect(masterGain);
    o2.start();

    // subtle noise texture
    const bufferSize = 2 * audioCtx.sampleRate;
    const noise = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const output = noise.getChannelData(0);
    for(let i=0;i<bufferSize;i++) output[i] = (Math.random()*2-1) * 0.25;
    const nb = audioCtx.createBufferSource();
    nb.buffer = noise;
    nb.loop = true;
    const nbFilter = audioCtx.createBiquadFilter(); nbFilter.type = 'bandpass'; nbFilter.frequency.value = 700;
    const nbGain = audioCtx.createGain(); nbGain.gain.value = 0.02;
    nb.connect(nbFilter); nbFilter.connect(nbGain); nbGain.connect(masterGain);
    nb.start();

    // LFO to breathe master gain
    const lfo = audioCtx.createOscillator(); lfo.type='sine'; lfo.frequency.value = 0.05;
    const lfoGain = audioCtx.createGain(); lfoGain.gain.value = 0.06;
    lfo.connect(lfoGain); lfoGain.connect(masterGain.gain);
    lfo.start();

    // ramp to audible
    masterGain.gain.exponentialRampToValueAtTime(0.12, audioCtx.currentTime + 3.0);

    isPlaying = true;
    audioBtn.textContent = 'Mute';
  }

  audioBtn.addEventListener('click', ()=>{
    if(!audioCtx) startAudio();
    if(isPlaying){
      masterGain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.6);
      isPlaying = false;
      audioBtn.textContent = 'Unmute';
    } else {
      // resume context if suspended
      if(audioCtx.state === 'suspended') audioCtx.resume();
      masterGain.gain.exponentialRampToValueAtTime(0.12, audioCtx.currentTime + 0.6);
      isPlaying = true;
      audioBtn.textContent = 'Mute';
    }
  });

  // start audio on first user gesture to satisfy autoplay rules
  window.addEventListener('pointerdown', function once(){ if(!audioCtx) startAudio(); window.removeEventListener('pointerdown', once); });

  /* ================================
     Small performance & misc helpers
     ================================ */
  // adaptive particle density (short)
  // (layers already scale with canvas size)

  // ensure canvas initial layers
  rebuildLayers();

  // expose openCampus for inline calls
  window.openCampus = openCampus;

  </script>
</body>
</html>
